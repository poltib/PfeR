<section>
  <div class="container">
    <h2 role="heading" aria-level="2" class="hidden">Content</h2>
    <h2 role="heading" aria-level="2" class="raceTitle"><%= @happening.name %> de <%= link_to @happening.owner.username, @happening.owner %></h2>
    <h3 role="heading" aria-level="3">Liège | <%= I18n.l @happening.date %></h3>
    <div class="head">
      <div class="visuels">
        <div class="map">
          <div id="map_canvas"></div>
          <div id="elevation_chart"></div>
        </div>
      </div>
      <div class="social">
        <ul>
          <% if user_signed_in? && @happening.user_id == current_user.id %>
            <li class="socialNetwork">
              <%= link_to new_happening_track_path(@happening), :'data-tooltip' => 'Ajouter un tracé' do %>
                <i class="icon-location"></i>
              <% end %>
            </li>
          <% end %>

          <li class="favorite">
            <% if user_signed_in? %>
              <% if current_user.user_statuses.where(happening_id: @happening.id).first %>
                <%= button_to [@happening, current_user.user_statuses.where(happening_id: @happening.id).first], method: :delete do %>
                  <span data-tooltip="Ne plus participer">
                    <i class="icon-cancel"></i>
                  </span>
                <% end %>
              <% else %>
                <%= form_for ([@happening, UserStatus.new]), :html => {:class => 'button_to' } do |f| %>
                  <%= f.hidden_field :user_id, :value => current_user.id %>
                  <%= f.hidden_field :happening_id, :value => @happening.id %>
                  <%= button_tag do %>
                    <span data-tooltip="Participer">
                      <i class="icon-check"></i>
                    </span>
                  <% end %>
                <% end %>
              <% end %>
            <% else %>
              <i class="icon-users"></i>
            <% end %>
            <%= link_to "( "+@happening.user_statuses.count.to_s+" )", happening_user_statuses_path(@happening) %>
          </li>

          <li class="favorite">
            <% if user_signed_in? %>
              <% if current_user.favorites.where(favoritable_id: @happening.id, favoritable_type: "Happening").first %>
                <%= button_to [@happening, current_user.favorites.where(favoritable_id: @happening.id, favoritable_type: "Happening").first], method: :delete do %>
                  <span data-tooltip="Supprimer des favorits">
                    <i class="icon-heart"></i>
                  </span>
                <% end %>
              <% else %>
                <%= form_for ([@happening, Favorite.new]), :html => {:class => 'button_to' } do |f| %>
                  <%= f.hidden_field :user_id, :value => current_user.id %>
                  <%= f.hidden_field :favoritable_id, :value => @happening.id %>
                  <%= f.hidden_field :favoritable_type, :value => "Happening" %>
                  <%= button_tag do %>
                    <span data-tooltip="Ajouter aux favorits">
                      <i class="icon-heart-empty"></i>
                    </span>
                  <% end %>
                <% end %>
              <% end %>
            <% else %>
              <i class="icon-heart"></i>
            <% end %>
            <%= link_to "( "+@happening.favorites.count.to_s+" )", happening_favorites_path(@happening) %>
          </li>
          <li class="socialNetwork"><a data-tooltip="Partager sur Facebook" href="http://www.facebook.com/share.php?u=<%= request.original_url %>" target="blank" rel="nofollow"><i class="icon-facebook-squared"></i></a></li>
          <li class="socialNetwork"><a data-tooltip="Partager sur Google plus" href="https://plus.google.com/share?url=<%= request.original_url %>" target="blank" rel="nofollow"><i class="icon-gplus-squared"></i></a></li>
          <li class="socialNetwork"><a data-tooltip="Partager sur Twitter" href="http://twitter.com/home?status=<%= request.original_url %>" target="blank" rel="nofollow"><i class="icon-twitter-squared"></i></a></li>
          <li class="socialNetwork"><a data-tooltip="Partager par mail" href="mailto:?subject=Course intéressante sur Sportfun&amp;body=Course intéressante <%= @happening.name %> : <%= request.original_url %>" rel="nofollow"><i class="icon-mail"></i></a></li>
        </ul>
      </div>
    </div>
    <div class="raceDetails">
      <div class="informations">
        <h3 role="heading" aria-level="3">Informations</h3>
        <ul>
          <li>Description : <%= @happening.description %></li>
          <li>Adresse : <%= @happening.address %></li>
          <li>lien : <a href"<%= @happening.link %>"><%= @happening.link %></a></li>
        </ul>
        <ul>
          <% for user in @happening.users %>
            <li><%= link_to user.username, user_path(user) %></li>
          <% end %>
        </ul>
      </div>
      <div class="gallery">
        <h3 role="heading" aria-level="3">Gallerie photo</h3>
        <% if user_signed_in? && current_user.id == @happening.user_id %>
          <span id="showImageForm" data-tooltip="Ajouter une image"><i class="icon-picture"></i></span>
        <% end %>
        <% if user_signed_in? && current_user.id == @happening.owner.id %>
          <%= form_for ([@happening, Image.new]), :html => { :multipart => true, :id => 'addImage' } do |f| %>
            <%= f.hidden_field :user_id, :value => current_user.id %>
            <%= f.hidden_field :imagable_id, :value => @happening.id %>
            <%= f.hidden_field :imagable_type, :value => "Happening" %>
            <%= f.label :image %>
            <%= f.file_field :image %>
            <%= f.submit %>
          <% end %>
        <% end %>
        <ul id="many" class="thumbs">
          <% for image in @happening.images %>
            <li>
              <a href="<%= image.image.url(:medium) %>" class="thumbnail">
                <%= image_tag image.image.url(:thumb) %>
              </a>
              <% if user_signed_in? && current_user.id == @happening.owner.id %>
                <%= button_to [@happening, image], method: :delete, data: { confirm: 'Are you sure?' }, form_class: "delete_image" do %>
                  <span data-tooltip="Supprimer la photo">
                    <i class="icon-cancel"></i>
                  </span>
                <% end %>
              <% end %>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
    <div class="sponsors">
      <h3 role="heading" aria-level="3">Sponsors</h3>
      <ul class="thumbs">
        <li></li>
      </ul>
    </div>
  </div>
</section>
<% content_for :script do %>
  <script type="text/javascript" src="https://www.google.com/jsapi"></script>
  <%= google_maps_api %>
  <%= tracks_to_js(@tracksJs) if @tracksJs %>
  <%= location_to_js(@location) if @location %>
<% end %>